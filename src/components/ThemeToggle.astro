---

---

<button
  type="button"
  data-theme-toggle
  class="inline-flex items-center rounded-full border border-gray-200 dark:border-gray-700 bg-white/90 dark:bg-gray-800/90 px-3 py-2 text-xl shadow-sm transition-all hover:shadow focus:outline-none focus-visible:ring-2 focus-visible:ring-primary-500 focus-visible:ring-offset-2 dark:focus-visible:ring-offset-gray-900"
  aria-label="切换主题"
  aria-pressed="false">
  <span data-emoji class="icon-moon icon-size-20 transition-transform duration-200 ease-out"></span>
</button>

<script is:inline>
  ;(() => {
    if (typeof window === 'undefined') return

    const storageKey = 'theme'
    const toggle = document.querySelector('[data-theme-toggle]')
    if (!toggle) return
    const emoji = toggle.querySelector('[data-emoji]')

    const setState = (isDark) => {
      document.documentElement.classList.toggle('dark', isDark)
      localStorage.setItem(storageKey, isDark ? 'dark' : 'light')
      toggle.setAttribute('aria-pressed', String(isDark))
      toggle.setAttribute('aria-label', isDark ? '切换为浅色模式' : '切换为深色模式')
      if (emoji) {
        emoji.classList.toggle('icon-moon', !isDark)
        emoji.classList.toggle('icon-sun', isDark)
        emoji.style.transform = isDark ? 'rotate(-12deg) scale(1.1)' : 'rotate(0deg) scale(1)'
      }
    }

    const init = () => {
      const stored = localStorage.getItem(storageKey)
      const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches
      const initial = stored ? stored === 'dark' : document.documentElement.classList.contains('dark') || prefersDark
      setState(initial)

      toggle.addEventListener('click', () => {
        const next = !document.documentElement.classList.contains('dark')
        setState(next)
      })
    }

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', init, { once: true })
    } else {
      init()
    }
  })()
</script>
